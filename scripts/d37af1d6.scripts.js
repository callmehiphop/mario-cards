"use strict";var app=angular.module("marioCardsApp",[]);app.controller("MainCtrl",["$scope","$timeout","Deck","Storage","Sounds",function(a,b,c,d,e){function f(){var b=a.game.highScore;(!b||a.game.attempts<b)&&(d.set("highScore",a.game.attempts),a.game.highScore=a.game.attempts)}var g,h,i=800;a.game={cards:c.cards,unmatchedPairs:c.cards.length/2,highScore:d.get("highScore")||0,attempts:0},a.flipCard=function(c){var d="match";if(!c.flipped&&!h){if(c.flip(),!g)return g=c,a.game.attempts++,void 0;if(c.name===g.name)return a.game.unmatchedPairs--,g=null,a.game.unmatchedPairs||(f(),d="win"),b(function(){e.play(d)},i),void 0;h=c,b(function(){e.play("noMatch"),h.flip(),g.flip(),g=h=null},i)}},a.reset=function(){c.flipAll(a.game.cards),g=h=null,a.game.attempts=0,b(function(){var b=a.game.cards.slice(0);a.game.unmatchedPairs=b.length/2,a.game.cards=c.shuffle(b)},i)}}]),app.constant("STORAGE_KEY","itsamemario"),app.value("cards",[{name:"mushroom",sets:2},{name:"flower",sets:2},{name:"star",sets:2},{name:"coins10",sets:1},{name:"coins20",sets:1},{name:"freeGuy",sets:1}]),app.value("soundList",{match:"assets/audio/match.wav",noMatch:"assets/audio/no-match.wav",win:"assets/audio/win.wav"}),app.factory("Card",function(){var a=function(a){this.name=a,this.flipped=!1};return a.prototype.flip=function(){this.flipped=!this.flipped},a}),app.service("Storage",["STORAGE_KEY",function(a){function b(){localStorage.setItem(a,JSON.stringify(c))}var c=JSON.parse(localStorage.getItem(a)||"{}");return{get:function(a){return c[a]},set:function(a,d){c[a]=d,b()},remove:function(a){delete c[a],b()}}}]),app.service("Sounds",["soundList",function(a){var b=window.Audio?new Audio:{};return b.autoplay=!0,{play:function(c){a[c]&&(b.src=a[c])}}}]),app.service("Deck",["Card","cards",function(a,b){function c(a){for(var b,c=[],d=a.length;d>0;d--)b=Math.floor(Math.random()*d),c.push(a.splice(b,1)[0]);return c}function d(a){angular.forEach(a,function(a){a.flipped=!1})}var e=[];return angular.forEach(b,function(b){for(var c=0;c<2*b.sets;c++)e.push(new a(b.name))}),{cards:c(e),shuffle:c,flipAll:d}}]);